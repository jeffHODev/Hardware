C51 COMPILER V9.60.0.0   MAIN                                                              12/01/2021 09:39:32 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\main.c COMPACT OPTIMIZE(0,SPEED) BROWSE INCDIR(.\Include) DEFINE(FO
                    -SC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\main.lst) TABS(2) OBJECT(.\Output\main.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2017 Nuvoton Technology Corp. All rights reserved.                                        
             - */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          //********************************************************************************************************
             -***
   8          //  Website: http://www.nuvoton.com
   9          //  E-Mail : MicroC-8bit@nuvoton.com
  10          //  Date   : Jan/21/2017
  11          //********************************************************************************************************
             -***
  12          
  13          //********************************************************************************************************
             -***
  14          //  File Function: N76E003 GPIO demo code
  15          //********************************************************************************************************
             -***
  16          #include "N76E003.h"
  17          #include "SFR_Macro.h"
  18          #include "Function_define.h"
  19          #include "eepromf.h"
  20          #include "Common.h"
  21          #include "Delay.h"
  22          #include "Bsp_init.h"
  23          
  24          uint8_t  Ms_Flage=0,dis_flag;           // 10ms标志
  25          //uint8_t  Second=0;              // 秒
  26          //uint8_t  Minute=0;              // 计时函数
  27          //uint8_t  Hour=0;                // 计时函数
  28          //uint8_t  MSecond=0;             // 10ms计数
  29          
  30          //*****************  The Following is in define in Fucntion_define.h  ***************************
  31          //****** Always include Function_define.h call the define you want, detail see main(void) *******
  32          //***********************************************************************************************
  33          
  34          /*********************************************************************************************************
             -***
  35          *    TIMER 1 interrupt subroutine
  36          **********************************************************************************************************
             -**/
  37          //code uint16_t Ele_Time_Table[6]= {10,60,120,180,240,300};
  38          uint32_t systick;
  39          
  40          void Timer1_ISR (void) interrupt 3  //interrupt address is 0x001B
  41          {
  42   1          static uint16_t time=0;
  43   1          uint8_t temp=0;
C51 COMPILER V9.60.0.0   MAIN                                                              12/01/2021 09:39:32 PAGE 2   

  44   1          systick++;
  45   1          TH1 = TIMER_DIV12_VALUE_10ms/256;
  46   1          TL1 = TIMER_DIV12_VALUE_10ms%256;
  47   1          // 蜂鸣器
  48   1          if(time++>=3)           // 30ms执行周期
  49   1          {
  50   2              time=0;
  51   2              Speak_value();
  52   2            if(dis_flag)
  53   2            {
  54   3            dis_flag = 0;
  55   3              Display_Process();
  56   3            }
  57   2             
  58   2          }
  59   1          
  60   1          // 10ms标志
  61   1          Ms_Flage=1;
  62   1      }
  63          
  64          /***********************************************************************
  65            WDT CONFIG enable
  66            warning : this macro is only when ICP not enable CONFIG WDT function
  67            copy this marco code to you code to enable WDT reset.
  68          ************************************************************************/
  69          void WDT_Config_Enable(void)
  70          {
  71   1          TA=0xAA;
  72   1          TA=0x55;
  73   1          WDCON|=0x03;      // Setting WDT prescale 102ms
  74   1          set_WDCLR;                        // Clear WDT timer
  75   1          while((WDCON|~SET_BIT6)==0xFF);   // confirm WDT clear is ok before into power down mode
  76   1          set_WDTR;                         // WDT run
  77   1      }
  78          uint32_t start_tick;
  79          extern uint8_t Charge_Mode ;
  80          /*------------------------------------------------
  81          The main C function.  Program execution starts
  82          here after stack initialization.
  83          ------------------------------------------------*/
  84          void main (void)
  85          {
  86   1           uint8_t keycode=0;               // 按键
  87   1          uint8_t init;                     // 初始化ADC
  88   1          unsigned char init_flag;
  89   1          init_flag = 1;
  90   1          Set_All_GPIO_Quasi_Mode;          // Define in Function_define.h
  91   1      
  92   1          Board_gpio_init();                // 初始化IO
  93   1          Timer1_init();                    // 初始化定时器
  94   1      
  95   1          if(Charge_Process())
  96   1              goto next;
  97   1          while((Button_Read(1)&KEY_START_HOLD)!=KEY_START_HOLD)
  98   1              key_reset();
  99   1      next:
 100   1          key_reset();
 101   1      
 102   1      
 103   1          WDT_Config_Enable();              // WDT run
 104   1          InitialUART0_Timer3(9600);        // 初始化串口1
 105   1          Read_EEprom();                    // 读取使用数据
C51 COMPILER V9.60.0.0   MAIN                                                              12/01/2021 09:39:32 PAGE 3   

 106   1          READ_BANDGAP();                   // 带隙电压出厂标定值
 107   1          for(init=0; init<50; init++)        // 检测电池电压
 108   1          {
 109   2              Init_adc_read();                // 初始化ADC
 110   2              //  set_WDCLR;                      // Clear WDT timer
 111   2          }
 112   1          display_init();
 113   1          init_flag = 0;
 114   1          // 读取ADC采样值
 115   1          while(1)
 116   1          {
 117   2          //  testt();
 118   2              //if(Charge_Set == 0)
 119   2              keycode=Button_Read(init_flag);       // 读取按键
 120   2              if(Ms_Flage==1)                 // 10ms延时标志位
 121   2              {
 122   3                  set_WDCLR;                    // Clear WDT timer
 123   3                  // 清除标志//22
 124   3      
 125   3                  Charge_Process();
 126   3                  Work_In_Set(keycode);         // 工作在设置模式下
 127   3                  Init_adc_read();              // 读取ADC采样值
 128   3                  Ms_Flage=0;
 129   3                  key_reset();
 130   3                  dis_flag = 1;
 131   3            //Send_Info();                  // 发送数据到串口
 132   3              }
 133   2      
 134   2              // 刷新显示
 135   2            //  Display_Process();                  // LED显示
 136   2      
 137   2          }
 138   1      }
 139          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    414    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =     16    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
